import{_ as a,o as l,c as o,V as s}from"./chunks/framework.fc84ac3a.js";const b=JSON.parse('{"title":"构建和开发 Magisk","description":"","frontmatter":{},"headers":[],"relativePath":"build.md","filePath":"build.md","lastUpdated":1684157238000}'),e={name:"build.md"},i=s(`<h1 id="构建和开发-magisk" tabindex="-1">构建和开发 Magisk <a class="header-anchor" href="#构建和开发-magisk" aria-label="Permalink to &quot;构建和开发 Magisk&quot;">​</a></h1><h2 id="设置环境" tabindex="-1">设置环境 <a class="header-anchor" href="#设置环境" aria-label="Permalink to &quot;设置环境&quot;">​</a></h2><ul><li>支持的平台： <ul><li>Linux x64</li><li>macOS x64 (Intel)</li><li>macOS arm64 (Apple Silicon)</li><li>Windows x64</li></ul></li><li>仅 Windows： 启用<a href="https://learn.microsoft.com/zh-cn/windows/apps/get-started/enable-your-device-for-development" target="_blank" rel="noreferrer">开发者模式</a>。因为需要支持符号链接。</li><li>安装 Python 3.8+： <ul><li>在 Unix 上，使用您喜欢的软件包管理器安装 python3</li><li>在 Windows 上，在<a href="https://www.python.org/downloads/windows/" target="_blank" rel="noreferrer">官方网站</a>上下载并安装 Python 最新的版本.<br> 请在安装过程中选择 <strong>“Add Python to PATH（将 Python 添加到 PATH）”</strong>。</li><li>(在 Windows 上，可选)：运行 <code>pip install colorama</code> 以安装 <code>colorama</code> python 包</li></ul></li><li>安装 Git： <ul><li>在 Unix 上，使用您喜欢的软件包管理器安装 git</li><li>在 Windows 上，在<a href="https://git-scm.com/download/win" target="_blank" rel="noreferrer">官方网站</a>上下载并安装最新的 Git 版本.<br> 请确保在安装过程前 <strong>“启用符号链接”</strong>。</li></ul></li><li>安装 Android Studio 并按照说明进行初始设置。</li><li>将环境变量 <code>ANDROID_SDK_ROOT</code> 设置为 Android SDK 文件夹。此路径可以在 Android Studio 设置中找到。</li><li>设置 JDK： <ul><li>建议的选项是将环境变量 <code>ANDROID_STUDIO</code> 设置为 Android Studio 的安装路径。构建脚本将自动查找并使用捆绑的 JDK。</li><li>您也可以自己设置 JDK 17，但本指南不包含说明。</li></ul></li><li>克隆源代码：</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">clone</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--recurse-submodules</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/topjohnwu/Magisk.git</span></span></code></pre></div><ul><li>运行 <code>./build.py ndk</code> 让脚本下载并安装 NDK</li></ul><h2 id="构建" tabindex="-1">构建 <a class="header-anchor" href="#构建" aria-label="Permalink to &quot;构建&quot;">​</a></h2><ul><li>要构建所有内容并创建最终的 Magisk APK，请运行 <code>./build.py all</code> 。</li><li>您还可以构建特定的子组件。调用 <code>build.py</code> 查看您的选项<br> 对于每个操作，使用 <code>-h</code> 访问帮助（例如 <code>./build.py binary -h</code> ）</li><li>使用 <code>config.prop</code> 配置构建。提供了示例 <code>config.prop.sample</code> 。</li></ul><h2 id="ide-支持" tabindex="-1">IDE 支持 <a class="header-anchor" href="#ide-支持" aria-label="Permalink to &quot;IDE 支持&quot;">​</a></h2><ul><li><a href="https://github.com/topjohnwu/Magisk/" target="_blank" rel="noreferrer">Magisk 的存储库</a>可以作为一个项目直接使用 Android Studio 打开。</li><li>项目中的 Kotlin、Java、C++ 和 C 代码应该在 Android Studio 中得到开箱即用的适当支持。</li><li>在处理原生（native）代码之前运行 <code>./build.py binary</code> ，因为某些生成的代码仅在构建过程中创建。</li></ul><h3 id="在-android-studio-中开发-rust" tabindex="-1">在 Android Studio 中开发 Rust <a class="header-anchor" href="#在-android-studio-中开发-rust" aria-label="Permalink to &quot;在 Android Studio 中开发 Rust&quot;">​</a></h3><p>由于 Magisk NDK 软件包 <a href="https://github.com/topjohnwu/ondk" target="_blank" rel="noreferrer">ONDK</a>（与 <code>./build.py ndk</code> 一起安装的软件包）包含一个完全独立的 Clang + Rust 工具链，因此单独构建 Magisk 项目不需要配置工具链。但是，由于 Intellij Rust 插件的工作方式，您必须进行一些额外的设置才能使 Android Studio 与 Magisk 的 Rust 代码库一起使用：</p><ul><li>安装官方 Rust 工具链管理器 <a href="https://rustup.rs/" target="_blank" rel="noreferrer">rustup</a></li><li>链接 ONDK Rust 工具链并将其设置为默认值：</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 将 ONDK 工具链与名称“magisk”链接起来</span></span>
<span class="line"><span style="color:#FFCB6B;">rustup</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">toolchain</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">link</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">magisk</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">$ANDROID_SDK_ROOT</span><span style="color:#C3E88D;">/ndk/magisk/toolchains/rust</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 设置为默认</span></span>
<span class="line"><span style="color:#FFCB6B;">rustup</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">magisk</span></span></code></pre></div><ul><li>在 Android Studio 中安装 <a href="https://www.jetbrains.com/rust/" target="_blank" rel="noreferrer">Intellij Rust 插件</a></li><li>在 首选项（Preferences） &gt; 语言和框架（Languages &amp; Frameworks） &gt; Rust 中，将 <code>$ANDROID_SDK_ROOT/ndk/magisk/toolchains/rust/bin</code> 设置为工具链位置</li><li>打开 <code>native/src/Cargo.toml</code> ，然后在“未找到 Cargo 项目（No Cargo projects found）”横幅中选择“附加（Attach）”</li></ul><h2 id="签名和分发" tabindex="-1">签名和分发 <a class="header-anchor" href="#签名和分发" aria-label="Permalink to &quot;签名和分发&quot;">​</a></h2><ul><li>在发布版本中，Magisk 的 root 守护程序将使用对 Magisk APK 进行密钥签名的证书作为参考，拒绝并强制卸载任何不匹配的 Magisk 应用，保护用户免受恶意和未经验证的 Magisk APK 的侵害。</li><li>要在 Magisk 本身上进行任何开发，请切换到 <strong>官方调试版本并重新安装 Magisk</strong> 以关闭签名检查。</li><li>要分发使用您自己的密钥签名的自己的 Magisk 构建，请在 <code>config.prop</code> 中设置您的签名配置。</li><li>查看 <a href="https://developer.android.google.cn/studio/publish/app-signing.html#generate-key" target="_blank" rel="noreferrer">Google 的文档</a>，了解有关生成自己的密钥的更多详细信息。</li></ul>`,16),t=[i];function n(r,d,c,p,u,h){return l(),o("div",null,t)}const k=a(e,[["render",n]]);export{b as __pageData,k as default};
